#version 460
#extension GL_NV_mesh_shader : require

// the second variable of vkCmdDrawMeshTasksNV()
layout(local_size_x = 1) in;
layout(triangles, max_vertices = 3, max_primitives = 1) out;

layout (location = 0) out PerVertexData {
  vec4 color;
} v_out[];

// vertex positions
const vec3 vertices[3] = { vec3(-0.5, 0.5, 0), vec3(0, -0.5, 0), vec3(0.5, 0.5, 0) };
const vec3 color[3] = { vec3(1, 0, 0), vec3(0, 1, 0), vec3(0, 0, 1) };

void main() {

  // following three gl_~NV variables are build in variables for mesh shading

  // register vertices position
  gl_MeshVerticesNV[0].gl_Position = vec4(vertices[0], 1.0);
  gl_MeshVerticesNV[1].gl_Position = vec4(vertices[1], 1.0);
  gl_MeshVerticesNV[2].gl_Position = vec4(vertices[2], 1.0);

  // register vertices color
  v_out[0].color = vec4(color[0], 1);
  v_out[1].color = vec4(color[1], 1);
  v_out[2].color = vec4(color[2], 1);

  // triangle indices
  gl_PrimitiveIndicesNV[0] = 0;
  gl_PrimitiveIndicesNV[1] = 1;
  gl_PrimitiveIndicesNV[2] = 2;

  // number of triangles
  gl_PrimitiveCountNV = 1;
}